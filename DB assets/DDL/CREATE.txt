CREATE TABLE MEMBERS(
	MB_NO NUMBER(4) NOT NULL,
	MB_ID VARCHAR2(20) NOT NULL,
	MB_PW VARCHAR2(20) NOT NULL,
	MB_NAME VARCHAR2(10) NOT NULL,
	MB_EMAIL VARCHAR2(30) NOT NULL,
	MB_PHONE VARCHAR2(15) NOT NULL,
	PRIMARY KEY(MB_NO)
);

CREATE TABLE CATEGORIES(
	C_NO NUMBER(4) NOT NULL,
	C_TITLE VARCHAR2(50) NOT NULL,
	PRIMARY KEY(C_NO)
);

CREATE TABLE SUBCATEGORIES(
	S_NO NUMBER(4) NOT NULL,
	S_TITLE VARCHAR2(50) NOT NULL,
	S_CATEGORY_NO NUMBER(4) NOT NULL,
	PRIMARY KEY(S_NO),
	FOREIGN KEY(S_CATEGORY_NO) REFERENCES CATEGORIES(C_NO) ON DELETE CASCADE
);

CREATE TABLE MENU(
	MN_NO NUMBER(4) NOT NULL,
	MN_NAME VARCHAR2(50) NOT NULL,
	MN_SUBCATEGORY_NO NUMBER(4) NOT NULL,
	MN_IMG VARCHAR2(200),
	MN_PRICE NUMBER(8) NOT NULL,
	MN_CALORIE NUMBER(5, 1),
	PRIMARY KEY(MN_NO),
	FOREIGN KEY(MN_SUBCATEGORY_NO) REFERENCES SUBCATEGORIES(S_NO) ON DELETE CASCADE
);

CREATE TABLE OPTIONS(
	OP_NO NUMBER(4) NOT NULL,
	OP_TITLE VARCHAR2(20) NOT NULL,
	OP_PRICE NUMBER(5) NOT NULL,
	PRIMARY KEY(OP_NO)
);

CREATE TABLE MENU_OPTION(
	MO_NO NUMBER(4) NOT NULL,
	MO_MENU_NO NUMBER(4) NOT NULL,
	MO_OPTION_NO NUMBER(4) NOT NULL,
	PRIMARY KEY(MO_NO),
	FOREIGN KEY(MO_MENU_NO) REFERENCES MENU(MN_NO) ON DELETE CASCADE,
	FOREIGN KEY(MO_OPTION_NO) REFERENCES OPTIONS(OP_NO) ON DELETE CASCADE
);

CREATE TABLE ALLERGY(
	A_NO NUMBER(4) NOT NULL,
	A_NAME VARCHAR2(20) NOT NULL,
	PRIMARY KEY(A_NO)
);

CREATE TABLE ALLERGY_MENU(
	AM_NO NUMBER(4) NOT NULL,
	AM_ALLERGY_NO NUMBER(4) NOT NULL,
	AM_MENU_NO NUMBER(4) NOT NULL,
	AM_GRADE CHAR(1) NOT NULL CHECK (AM_GRADE IN ('상', '중', '하')),
	PRIMARY KEY(AM_NO),
	FOREIGN KEY(AM_ALLERGY_NO) REFERENCES ALLERGY(A_NO) ON DELETE CASCADE,
	FOREIGN KEY(AM_MENU_NO) REFERENCES MENU(MN_NO) ON DELETE CASCADE
);

CREATE TABLE ORDERS(
	OR_NO NUMBER(4) NOT NULL,
	OR_MEMBER_NO NUMBER(4) NOT NULL,
	OR_MENU_NO NUMBER(4) NOT NULL,
	OR_ORDERTIME TIMESTAMP DEFAULT SYSDATE,
	OR_CANCELTIME TIMESTAMP DEFAULT SYSDATE,
	OR_STATE VARCHAR2(10) DEFAULT 'ACCEPTED' CHECK (OR_STATE IN ('ACCEPTED', 'CANCELED')),
	PRIMARY KEY(OR_NO),
	FOREIGN KEY(OR_MEMBER_NO) REFERENCES MEMBERS(MB_NO) ON DELETE CASCADE,
	FOREIGN KEY(OR_MENU_NO) REFERENCES MENU(MN_NO) ON DELETE CASCADE
);

CREATE TABLE ORDER_OPTION(
	OO_NO NUMBER(4) NOT NULL,
	OO_ORDER_NO NUMBER(4) NOT NULL,
	OO_OPTION_NO NUMBER(4) NOT NULL,
	PRIMARY KEY(OO_NO),
	FOREIGN KEY(OO_ORDER_NO) REFERENCES ORDERS(OR_NO) ON DELETE CASCADE,
	FOREIGN KEY(OO_OPTION_NO) REFERENCES OPTIONS(OP_NO) ON DELETE CASCADE
);

CREATE TABLE STORES(
	ST_NO NUMBER(4) NOT NULL,
	ST_NAME VARCHAR2(30) NOT NULL,
	ST_ADDR VARCHAR2(500) NOT NULL,
	ST_PHONE VARCHAR2(15) NOT NULL,
	PRIMARY KEY(ST_NO)
);

CREATE TABLE REGIONS(
	R_NO NUMBER(4) NOT NULL,
	R_NAME VARCHAR2(30) NOT NULL,
	PRIMARY KEY(R_NO)
);

CREATE TABLE SUBREGIONS(
	SR_NO NUMBER(4) NOT NULL,
	SR_NAME VARCHAR2(30) NOT NULL,
	SR_REGION_NO NUMBER(4) NOT NULL,
	PRIMARY KEY(SR_NO),
	FOREIGN KEY(SR_REGION_NO) REFERENCES REGIONS(R_NO) ON DELETE CASCADE
);

CREATE SEQUENCE MB_SEQ;
CREATE SEQUENCE C_SEQ;
CREATE SEQUENCE S_SEQ;
CREATE SEQUENCE MN_SEQ;
CREATE SEQUENCE OP_SEQ;
CREATE SEQUENCE MO_SEQ;
CREATE SEQUENCE OR_SEQ;
CREATE SEQUENCE OO_SEQ;
CREATE SEQUENCE ST_SEQ;
CREATE SEQUENCE A_SEQ;
CREATE SEQUENCE AM_SEQ;


COMMIT;